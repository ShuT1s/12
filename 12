#13. Вычислить сумму знакопеременного ряда (|х(n-1)|)/(n-1)!, где х-матрица ранга к (к и
# матрица задаются случайным образом), n - номер слагаемого. Сумма считается вычисленной,
# если точность вычислений будет не меньше t знаков после запятой.
# У алгоритма д.б. линейная сложность. Знак первого слагаемого  -.
import numpy as np
import random
from decimal import Decimal
while True:
#ввод данных с проверкой
    while True:
        t = input("Введите количество знаков после запятой для точности вычислений: ")
        if t.isdigit():
            if int(t) == 0:
                print("Вы ввели ноль. Введите другое число")
            else:
                t = int(t)
                break
        else:
            print("Вы должны были ввести натуральное число")
    #формирование матрицы
    k = random.randint(1, 5)
    matrix = np.random.uniform(-1, 1, size=(k, k))
    #вывод матрицы
    print("Сгенерирована матрица:\n", matrix)
    #вычисление суммы знакопеременного ряда
    summ = 0
    factorial = 1
    i = 1
    #работа с первым слагаемым
    prev = -abs(np.linalg.det((matrix * factorial).astype("float64")) / factorial)  #prev- предыд слагаемое, мы учитываем самое первое, чтобы дать ему знак "-" по условию
    summ += prev  #добавляем его в сумму ряда
    sign = "-"  #знак предыдущего числа. в данном случае это "-"
    factorial += 1  #факториал увел на 1, т.к. рассм след слагаемое
    #работа с остальными слагаемыми
    while True:
        factorial = factorial * i
        i += 1
        value = abs(np.linalg.det((matrix * factorial).astype("float64")) / factorial)
        diff = abs(prev) - abs(value)  #разница предыд и текущ слагаемых.
        if Decimal(str(diff)).as_tuple().exponent * (-1) < t:  #находим разницу между предыд. и текущ. числами, если в результате кол-во
            break  #знаков после запятой меньше заданного кол-ва t, то выходим из цикла
        if sign == "+":  #учет знаков слагаемых
            summ += -value
            sign = "-"
        elif sign == "-":
            summ += value
            sign = "+"
    #вывод результатов
    print(f"Сумма ряда равна: {summ:.{t}f}")
    a=input("Для завершения работы нижмите 1:")
    if a=="1":
        break
